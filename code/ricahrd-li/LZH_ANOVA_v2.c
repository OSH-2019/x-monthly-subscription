#include<linux/bpf.h>

__u32 calculate_mean( __u64 x[]){
    __u32 mean=0;

    //循环展开
    mean=(x[0]+x[1]+x[2]+x[3]+x[4]+x[5]+x[6]+x[7]+x[8]+x[9]+x[10]+x[11]+x[12]+x[13]+x[14]+x[15]+x[16]+
         x[17]+x[18]+x[19]+x[20]+x[21]+x[22]+x[23]+x[24]+x[25]+x[26]+x[27]+x[28]+x[29]+x[30]+x[31])>>4;
    return mean;
}

__u64 calculate_var(__u64 x[],__u32 mean){
   __u64 var=0;

   var=((x[0]*x[0]+x[1]*x[1]+x[2]*x[2]+x[3]*x[3]+x[4]*x[4]
       +x[5]*x[5]+x[6]*x[6]+x[7]*x[7]+x[8]*x[8]+x[9]*x[9]
       +x[10]*x[10]+x[11]*x[11]+x[12]*x[12]+x[13]*x[13]+x[14]*x[14]
       +x[15]*x[15]+x[16]*x[16]+x[17]*x[17]+x[18]*x[18]+x[19]*x[19]
       +x[20]*x[20]+x[21]*x[21]+x[22]*x[22]+x[23]*x[23]+x[24]*x[24]
       +x[25]*x[25]+x[26]*x[26]+x[27]*x[27]+x[28]*x[28]+x[29]*x[29]
       +x[30]*x[30]+x[31]*x[31])>>4)-(__u64)mean*mean;
   return var;
}

/*
[osh@agilio1415 ~]$ clang  -target bpf -c LZH_ANOVA_v2.c -o LZH_test.o
[osh@agilio1415 ~]$ llvm-objdump-4.0 -S LZH_test.o
llvm-objdump-4.0 -S LZH_test.o

LZH_test.o:     file format ELF64-BPF

Disassembly of section .text:
calculate_mean:
       0:       bf 12 00 00 00 00 00 00         r2 = r1
       1:       7b 1a f8 ff 00 00 00 00         *(u64 *)(r10 - 8) = r1
       2:       b7 01 00 00 00 00 00 00         r1 = 0
       3:       63 1a f4 ff 00 00 00 00         *(u32 *)(r10 - 12) = r1
       4:       79 a1 f8 ff 00 00 00 00         r1 = *(u64 *)(r10 - 8)
       5:       79 13 00 00 00 00 00 00         r3 = *(u64 *)(r1 + 0)
       6:       79 14 08 00 00 00 00 00         r4 = *(u64 *)(r1 + 8)
       7:       0f 43 00 00 00 00 00 00         r3 += r4
       8:       79 14 10 00 00 00 00 00         r4 = *(u64 *)(r1 + 16)
       9:       0f 43 00 00 00 00 00 00         r3 += r4
      10:       79 14 18 00 00 00 00 00         r4 = *(u64 *)(r1 + 24)
      11:       0f 43 00 00 00 00 00 00         r3 += r4
      12:       79 14 20 00 00 00 00 00         r4 = *(u64 *)(r1 + 32)
      13:       0f 43 00 00 00 00 00 00         r3 += r4
      14:       79 14 28 00 00 00 00 00         r4 = *(u64 *)(r1 + 40)
      15:       0f 43 00 00 00 00 00 00         r3 += r4
      16:       79 14 30 00 00 00 00 00         r4 = *(u64 *)(r1 + 48)
      17:       0f 43 00 00 00 00 00 00         r3 += r4
      18:       79 14 38 00 00 00 00 00         r4 = *(u64 *)(r1 + 56)
      19:       0f 43 00 00 00 00 00 00         r3 += r4
      20:       79 14 40 00 00 00 00 00         r4 = *(u64 *)(r1 + 64)
      21:       0f 43 00 00 00 00 00 00         r3 += r4
      22:       79 14 48 00 00 00 00 00         r4 = *(u64 *)(r1 + 72)
      23:       0f 43 00 00 00 00 00 00         r3 += r4
      24:       79 14 50 00 00 00 00 00         r4 = *(u64 *)(r1 + 80)
      25:       0f 43 00 00 00 00 00 00         r3 += r4
      26:       79 14 58 00 00 00 00 00         r4 = *(u64 *)(r1 + 88)
      27:       0f 43 00 00 00 00 00 00         r3 += r4
      28:       79 14 60 00 00 00 00 00         r4 = *(u64 *)(r1 + 96)
      29:       0f 43 00 00 00 00 00 00         r3 += r4
      30:       79 14 68 00 00 00 00 00         r4 = *(u64 *)(r1 + 104)
      31:       0f 43 00 00 00 00 00 00         r3 += r4
      32:       79 14 70 00 00 00 00 00         r4 = *(u64 *)(r1 + 112)
      33:       0f 43 00 00 00 00 00 00         r3 += r4
      34:       79 14 78 00 00 00 00 00         r4 = *(u64 *)(r1 + 120)
      35:       0f 43 00 00 00 00 00 00         r3 += r4
      36:       79 14 80 00 00 00 00 00         r4 = *(u64 *)(r1 + 128)
      37:       0f 43 00 00 00 00 00 00         r3 += r4
      38:       79 14 88 00 00 00 00 00         r4 = *(u64 *)(r1 + 136)
      39:       0f 43 00 00 00 00 00 00         r3 += r4
      40:       79 14 90 00 00 00 00 00         r4 = *(u64 *)(r1 + 144)
      41:       0f 43 00 00 00 00 00 00         r3 += r4
      42:       79 14 98 00 00 00 00 00         r4 = *(u64 *)(r1 + 152)
      43:       0f 43 00 00 00 00 00 00         r3 += r4
      44:       79 14 a0 00 00 00 00 00         r4 = *(u64 *)(r1 + 160)
      45:       0f 43 00 00 00 00 00 00         r3 += r4
      46:       79 14 a8 00 00 00 00 00         r4 = *(u64 *)(r1 + 168)
      47:       0f 43 00 00 00 00 00 00         r3 += r4
      48:       79 14 b0 00 00 00 00 00         r4 = *(u64 *)(r1 + 176)
      49:       0f 43 00 00 00 00 00 00         r3 += r4
      50:       79 14 b8 00 00 00 00 00         r4 = *(u64 *)(r1 + 184)
      51:       0f 43 00 00 00 00 00 00         r3 += r4
      52:       79 14 c0 00 00 00 00 00         r4 = *(u64 *)(r1 + 192)
      53:       0f 43 00 00 00 00 00 00         r3 += r4
      54:       79 14 c8 00 00 00 00 00         r4 = *(u64 *)(r1 + 200)
      55:       0f 43 00 00 00 00 00 00         r3 += r4
      56:       79 14 d0 00 00 00 00 00         r4 = *(u64 *)(r1 + 208)
      57:       0f 43 00 00 00 00 00 00         r3 += r4
      58:       79 14 d8 00 00 00 00 00         r4 = *(u64 *)(r1 + 216)
      59:       0f 43 00 00 00 00 00 00         r3 += r4
      60:       79 14 e0 00 00 00 00 00         r4 = *(u64 *)(r1 + 224)
      61:       0f 43 00 00 00 00 00 00         r3 += r4
      62:       79 14 e8 00 00 00 00 00         r4 = *(u64 *)(r1 + 232)
      63:       0f 43 00 00 00 00 00 00         r3 += r4
      64:       79 14 f0 00 00 00 00 00         r4 = *(u64 *)(r1 + 240)
      65:       0f 43 00 00 00 00 00 00         r3 += r4
      66:       79 11 f8 00 00 00 00 00         r1 = *(u64 *)(r1 + 248)
      67:       0f 13 00 00 00 00 00 00         r3 += r1
      68:       77 03 00 00 04 00 00 00         r3 >>= 4
      69:       63 3a f4 ff 00 00 00 00         *(u32 *)(r10 - 12) = r3
      70:       61 a0 f4 ff 00 00 00 00         r0 = *(u32 *)(r10 - 12)
      71:       7b 2a e8 ff 00 00 00 00         *(u64 *)(r10 - 24) = r2
      72:       95 00 00 00 00 00 00 00         exit

calculate_var:
      73:       bf 23 00 00 00 00 00 00         r3 = r2
      74:       bf 14 00 00 00 00 00 00         r4 = r1
      75:       7b 1a f8 ff 00 00 00 00         *(u64 *)(r10 - 8) = r1
      76:       63 2a f4 ff 00 00 00 00         *(u32 *)(r10 - 12) = r2
      77:       b7 01 00 00 00 00 00 00         r1 = 0
      78:       7b 1a e8 ff 00 00 00 00         *(u64 *)(r10 - 24) = r1
      79:       79 a1 f8 ff 00 00 00 00         r1 = *(u64 *)(r10 - 8)
      80:       79 12 00 00 00 00 00 00         r2 = *(u64 *)(r1 + 0)
      81:       2f 22 00 00 00 00 00 00         r2 *= r2
      82:       79 15 08 00 00 00 00 00         r5 = *(u64 *)(r1 + 8)
      83:       2f 55 00 00 00 00 00 00         r5 *= r5
      84:       0f 52 00 00 00 00 00 00         r2 += r5
      85:       79 15 10 00 00 00 00 00         r5 = *(u64 *)(r1 + 16)
      86:       2f 55 00 00 00 00 00 00         r5 *= r5
      87:       0f 52 00 00 00 00 00 00         r2 += r5
      88:       79 15 18 00 00 00 00 00         r5 = *(u64 *)(r1 + 24)
      89:       2f 55 00 00 00 00 00 00         r5 *= r5
      90:       0f 52 00 00 00 00 00 00         r2 += r5
      91:       79 15 20 00 00 00 00 00         r5 = *(u64 *)(r1 + 32)
      92:       2f 55 00 00 00 00 00 00         r5 *= r5
      93:       0f 52 00 00 00 00 00 00         r2 += r5
      94:       79 15 28 00 00 00 00 00         r5 = *(u64 *)(r1 + 40)
      95:       2f 55 00 00 00 00 00 00         r5 *= r5
      96:       0f 52 00 00 00 00 00 00         r2 += r5
      97:       79 15 30 00 00 00 00 00         r5 = *(u64 *)(r1 + 48)
      98:       2f 55 00 00 00 00 00 00         r5 *= r5
      99:       0f 52 00 00 00 00 00 00         r2 += r5
     100:       79 15 38 00 00 00 00 00         r5 = *(u64 *)(r1 + 56)
     101:       2f 55 00 00 00 00 00 00         r5 *= r5
     102:       0f 52 00 00 00 00 00 00         r2 += r5
     103:       79 15 40 00 00 00 00 00         r5 = *(u64 *)(r1 + 64)
     104:       2f 55 00 00 00 00 00 00         r5 *= r5
     105:       0f 52 00 00 00 00 00 00         r2 += r5
     106:       79 15 48 00 00 00 00 00         r5 = *(u64 *)(r1 + 72)
     107:       2f 55 00 00 00 00 00 00         r5 *= r5
     108:       0f 52 00 00 00 00 00 00         r2 += r5
     109:       79 15 50 00 00 00 00 00         r5 = *(u64 *)(r1 + 80)
     110:       2f 55 00 00 00 00 00 00         r5 *= r5
     111:       0f 52 00 00 00 00 00 00         r2 += r5
     112:       79 15 58 00 00 00 00 00         r5 = *(u64 *)(r1 + 88)
     113:       2f 55 00 00 00 00 00 00         r5 *= r5
     114:       0f 52 00 00 00 00 00 00         r2 += r5
     115:       79 15 60 00 00 00 00 00         r5 = *(u64 *)(r1 + 96)
     116:       2f 55 00 00 00 00 00 00         r5 *= r5
     117:       0f 52 00 00 00 00 00 00         r2 += r5
     118:       79 15 68 00 00 00 00 00         r5 = *(u64 *)(r1 + 104)
     119:       2f 55 00 00 00 00 00 00         r5 *= r5
     120:       0f 52 00 00 00 00 00 00         r2 += r5
     121:       79 15 70 00 00 00 00 00         r5 = *(u64 *)(r1 + 112)
     122:       2f 55 00 00 00 00 00 00         r5 *= r5
     123:       0f 52 00 00 00 00 00 00         r2 += r5
     124:       79 15 78 00 00 00 00 00         r5 = *(u64 *)(r1 + 120)
     125:       2f 55 00 00 00 00 00 00         r5 *= r5
     126:       0f 52 00 00 00 00 00 00         r2 += r5
     127:       79 15 80 00 00 00 00 00         r5 = *(u64 *)(r1 + 128)
     128:       2f 55 00 00 00 00 00 00         r5 *= r5
     129:       0f 52 00 00 00 00 00 00         r2 += r5
     130:       79 15 88 00 00 00 00 00         r5 = *(u64 *)(r1 + 136)
     131:       2f 55 00 00 00 00 00 00         r5 *= r5
     132:       0f 52 00 00 00 00 00 00         r2 += r5
     133:       79 15 90 00 00 00 00 00         r5 = *(u64 *)(r1 + 144)
     134:       2f 55 00 00 00 00 00 00         r5 *= r5
     135:       0f 52 00 00 00 00 00 00         r2 += r5
     136:       79 15 98 00 00 00 00 00         r5 = *(u64 *)(r1 + 152)
     137:       2f 55 00 00 00 00 00 00         r5 *= r5
     138:       0f 52 00 00 00 00 00 00         r2 += r5
     139:       79 15 a0 00 00 00 00 00         r5 = *(u64 *)(r1 + 160)
     140:       2f 55 00 00 00 00 00 00         r5 *= r5
     141:       0f 52 00 00 00 00 00 00         r2 += r5
     142:       79 15 a8 00 00 00 00 00         r5 = *(u64 *)(r1 + 168)
     143:       2f 55 00 00 00 00 00 00         r5 *= r5
     144:       0f 52 00 00 00 00 00 00         r2 += r5
     145:       79 15 b0 00 00 00 00 00         r5 = *(u64 *)(r1 + 176)
     146:       2f 55 00 00 00 00 00 00         r5 *= r5
     147:       0f 52 00 00 00 00 00 00         r2 += r5
     148:       79 15 b8 00 00 00 00 00         r5 = *(u64 *)(r1 + 184)
     149:       2f 55 00 00 00 00 00 00         r5 *= r5
     150:       0f 52 00 00 00 00 00 00         r2 += r5
     151:       79 15 c0 00 00 00 00 00         r5 = *(u64 *)(r1 + 192)
     152:       2f 55 00 00 00 00 00 00         r5 *= r5
     153:       0f 52 00 00 00 00 00 00         r2 += r5
     154:       79 15 c8 00 00 00 00 00         r5 = *(u64 *)(r1 + 200)
     155:       2f 55 00 00 00 00 00 00         r5 *= r5
     156:       0f 52 00 00 00 00 00 00         r2 += r5
     157:       79 15 d0 00 00 00 00 00         r5 = *(u64 *)(r1 + 208)
     158:       2f 55 00 00 00 00 00 00         r5 *= r5
     159:       0f 52 00 00 00 00 00 00         r2 += r5
     160:       79 15 d8 00 00 00 00 00         r5 = *(u64 *)(r1 + 216)
     161:       2f 55 00 00 00 00 00 00         r5 *= r5
     162:       0f 52 00 00 00 00 00 00         r2 += r5
     163:       79 15 e0 00 00 00 00 00         r5 = *(u64 *)(r1 + 224)
     164:       2f 55 00 00 00 00 00 00         r5 *= r5
     165:       0f 52 00 00 00 00 00 00         r2 += r5
     166:       79 15 e8 00 00 00 00 00         r5 = *(u64 *)(r1 + 232)
     167:       2f 55 00 00 00 00 00 00         r5 *= r5
     168:       0f 52 00 00 00 00 00 00         r2 += r5
     169:       79 15 f0 00 00 00 00 00         r5 = *(u64 *)(r1 + 240)
     170:       2f 55 00 00 00 00 00 00         r5 *= r5
     171:       0f 52 00 00 00 00 00 00         r2 += r5
     172:       79 11 f8 00 00 00 00 00         r1 = *(u64 *)(r1 + 248)
     173:       2f 11 00 00 00 00 00 00         r1 *= r1
     174:       0f 12 00 00 00 00 00 00         r2 += r1
     175:       77 02 00 00 04 00 00 00         r2 >>= 4
     176:       61 a1 f4 ff 00 00 00 00         r1 = *(u32 *)(r10 - 12)
     177:       2f 11 00 00 00 00 00 00         r1 *= r1
     178:       1f 12 00 00 00 00 00 00         r2 -= r1
     179:       7b 2a e8 ff 00 00 00 00         *(u64 *)(r10 - 24) = r2
     180:       79 a0 e8 ff 00 00 00 00         r0 = *(u64 *)(r10 - 24)
     181:       7b 3a e0 ff 00 00 00 00         *(u64 *)(r10 - 32) = r3
     182:       7b 4a d8 ff 00 00 00 00         *(u64 *)(r10 - 40) = r4
     183:       95 00 00 00 00 00 00 00         exit
*/
